!function(f,a,c){var s,l=256,p="random",d=c.pow(l,6),g=c.pow(2,52),y=2*g,h=255;function n(n,t,r){function e(){for(var n=u.g(6),t=d,r=0;n<g;)n=(n+r)*l,t*=l,r=u.g(1);for(;y<=n;)n/=2,t/=2,r>>>=1;return(n+r)/t}var o=[],i=j(function n(t,r){var e,o=[],i=typeof t;if(r&&"object"==i)for(e in t)try{o.push(n(t[e],r-1))}catch(n){}return o.length?o:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[n,S(a)]:null==n?function(){try{var n;return s&&(n=s.randomBytes)?n=n(l):(n=new Uint8Array(l),(f.crypto||f.msCrypto).getRandomValues(n)),S(n)}catch(n){var t=f.navigator,r=t&&t.plugins;return[+new Date,f,r,f.screen,S(a)]}}():n,3),o),u=new m(o);return e.int32=function(){return 0|u.g(4)},e.quick=function(){return u.g(4)/4294967296},e.double=e,j(S(u.S),a),(t.pass||r||function(n,t,r,e){return e&&(e.S&&v(e,u),n.state=function(){return v(u,{})}),r?(c[p]=n,t):n})(e,i,"global"in t?t.global:this==c,t.state)}function m(n){var t,r=n.length,u=this,e=0,o=u.i=u.j=0,i=u.S=[];for(r||(n=[r++]);e<l;)i[e]=e++;for(e=0;e<l;e++)i[e]=i[o=h&o+n[e%r]+(t=i[e])],i[o]=t;(u.g=function(n){for(var t,r=0,e=u.i,o=u.j,i=u.S;n--;)t=i[e=h&e+1],r=r*l+i[h&(i[e]=i[o=h&o+t])+(i[o]=t)];return u.i=e,u.j=o,r})(l)}function v(n,t){return t.i=n.i,t.j=n.j,t.S=n.S.slice(),t}function j(n,t){for(var r,e=n+"",o=0;o<e.length;)t[h&o]=h&(r^=19*t[h&o])+e.charCodeAt(o++);return S(t)}function S(n){return String.fromCharCode.apply(0,n)}if(j(c.random(),a),"object"==typeof module&&module.exports){module.exports=n;try{s=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd?define((function(){return n})):c["seed"+p]=n}("undefined"!=typeof self?self:this,[],Math);class Game{static init(config){switch(this.config=config,console.log("Running Config: "+config.name),this.cli_mode="undefined"==typeof document,this.cli_mode?(this.width=1024,this.height=768):("true"==Utils.cookies().standard?(this.width=1024,this.height=768):(this.width=document.documentElement.clientWidth,this.height=document.documentElement.clientHeight),this.canvas=new Canvas,this.canvas.canvas.width=this.width,this.canvas.canvas.height=this.height),this.tick=0,Game.drawables=[],Game.updatables=[],Game.last_food_tick=0,Game.food=[],Game.snakes=[],Game.ended=!1,this.drawables.push(new Static.Text(this.config.name,20,40,30,"left")),Game.config.starting_food_mode){case"rng":Game.add_random_foods(Game.config.starting_food);break;case"grid":Game.add_food_grid(Game.config.grid_size)}Stats.clear(),this.snake_registry={};var starting_snakes_left=Game.config.min_starting_snakes;Game.config.starting_behaviours.forEach((function(behaviour){[...Array(Game.config.snakes_of_each_behaviour)].forEach((function(_){Game.add_snake(behaviour),starting_snakes_left--}))})),starting_snakes_left>0&&[...Array(starting_snakes_left)].forEach((function(_){Game.add_random_snake()})),this.cli_mode||(Game.draw_loop=setInterval((function(){requestAnimationFrame(Game.draw)}),10),Game.update_loop=setInterval(Game.update,10))}static update(){Game.updatables.forEach((function(updatable){updatable.update()})),Game.add_food(),Game.tick++,Game.snakes.length<Game.config.min_snakes&&Game.add_random_snake(),0==Game.snakes.length?(Game.game_over_message("Game over: No snakes remain"),Game.end()):Game.snakes.forEach((function(snake){snake.behaviour.every_tick()})),Game.tick>=3e4&&(Game.game_over_message("Game Over: 5 minute limit has been reached"),Game.end())}static game_over_message(text){console.log(Game.tick+": "+text),Game.drawables.push(new Static.Text(text+"("+Game.tick+")",Game.width-20,40,30,"right"))}static draw(){Game.canvas.clear(),Game.drawables.forEach((function(drawable){drawable.draw()})),"1"==Utils.cookies().stat_mode||1==Utils.cookies().stat_mode?Stats.draw_summaries():"2"!=Utils.cookies().stat_mode&&2!=Utils.cookies().stat_mode||Stats.draw_snakes()}static add_random_snake(){var behaviour=Game.config.respawn_behaviours[Math.floor(Math.random()*Game.config.respawn_behaviours.length)];Game.add_snake(behaviour)}static add_random_foods(n){[...Array(n)].forEach((function(_){new Static.Food}))}static add_food_grid(size){for(var grid_width=Math.floor(Game.width/size),grid_height=Math.floor(Game.height/size),row=0,col=0;row<=grid_height;){for(col=0;col<=grid_width;){var food=new Static.Food;food.x=col*size,food.y=row*size,col++}row++}}static add_food(){Game.tick-Game.last_food_tick>=Game.config.food_interval&&(Game.last_food_tick=Game.tick,new Static.Food)}static add_snake(behaviour){return new Creatures.Snake(behaviour)}static end(){Game.ended=!0,clearInterval(Game.draw_loop),clearInterval(Game.update_loop)}static register_snake(name){return void 0===Game.snake_registry[name]&&(Game.snake_registry[name]=0),Game.snake_registry[name]++,name+"["+Game.snake_registry[name]+"]"}}class Canvas{constructor(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.to_radians=Math.PI/180,addEventListener("keyup",(function(e){if("m"==e.key)window.open("menu.html");else if("s"==e.key){var stat_mode=parseInt(Utils.cookies().stat_mode||0);stat_mode+=1,stat_mode%=3,document.cookie="stat_mode="+stat_mode,Utils.cookies().stat_mode=stat_mode}}))}draw_circle(source){this.ctx.lineWidth=5,this.ctx.fillStyle=source.colour,this.ctx.beginPath(),this.ctx.arc(source.x,source.y,source.size,0,360),this.ctx.fill()}draw_square(source){this.ctx.lineWidth=5,this.ctx.strokeStyle=source.colour,this.ctx.strokeRect(source.x-source.size/2,source.y-source.size/2,source.size,source.size)}draw_text(text,x,y,colour,align,size){this.ctx.font=size+"px Arial",this.ctx.textAlign=align,this.ctx.fillStyle=colour,this.ctx.fillText(text,x,y)}draw_line(thing_one,thing_two,colour,thickness){this.ctx.lineWidth=thickness,this.ctx.strokeStyle=colour,this.ctx.beginPath(),this.ctx.moveTo(thing_one.x,thing_one.y),this.ctx.lineTo(thing_two.x,thing_two.y),this.ctx.stroke()}clear(){this.ctx.clearRect(0,0,Game.width,Game.height)}}class Utils{static angleDifference(angle1,angle2){var diff=(angle2-angle1+180)%360-180;return diff<-180?diff+360:diff}static outOfRange(thing){return thing.x<-200||thing.x>Game.width+200||thing.y<-200||thing.y>Game.height+200}static angleBetweenPoints(thing_one,thing_two){return 180*Math.atan2(thing_one.y-thing_two.y,thing_one.x-thing_two.x)/Math.PI+180}static distanceBetweenPoints(thing_one,thing_two){var a=thing_one.x-thing_two.x,b=thing_one.y-thing_two.y;return Math.sqrt(a*a+b*b)}static touching(thing_one,thing_two){return Utils.distanceBetweenPoints(thing_one,thing_two)<=thing_one.size+thing_two.size}static median(array){var mid=Math.floor(array.length/2);return[...array].sort((a,b)=>a-b)[mid]}static url_vars(){if("undefined"!=typeof window){var vars={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(m,key,value){vars[key]=value}));return vars}}static cookies(){if("undefined"==typeof document)return{};if(void 0!==this.cached_cookies)return this.cached_cookies;for(var str=document.cookie.split("; "),result={},i=0;i<str.length;i++){var cur=str[i].split("=");result[cur[0]]=cur[1]}return this.cached_cookies=result,result}static pairs_for(n_options){for(var n1=0,n2=0,pairs=[];n1<n_options;){for(n2=n1;n2<n_options;)pairs.push([n1,n2]),n2++;n1++}return pairs}static change_alpha(colour,alpha){var matches=colour.match(/(rgba\([0-9]+,[0-9]+,[0-9]+,).*(\))/);return`${matches[1]}${alpha}${matches[2]}`}}function mix(...mixins){class Mix{}for(let mixin of mixins)copyProperties(Mix,mixin),copyProperties(Mix.prototype,mixin.prototype);return Mix}function copyProperties(target,source){for(let key of Reflect.ownKeys(source))if("constructor"!==key&&"prototype"!==key&&"name"!==key){let desc=Object.getOwnPropertyDescriptor(source,key);Object.defineProperty(target,key,desc)}}String.prototype.leftJustify=function(length){for(var fill=[];fill.length+this.length<length;)fill[fill.length]=" ";return this+fill.join("")},String.prototype.rightJustify=function(length){for(var fill=[];fill.length+this.length<length;)fill[fill.length]=" ";return fill.join("")+this};class Stats{static for_behaviour(behaviour_name){return void 0===Stats.stats&&(Stats.stats={}),void 0===Stats.stats[behaviour_name]&&(Stats.stats[behaviour_name]=new Stats(behaviour_name)),Stats.stats[behaviour_name]}static clear(){Stats.stats=[]}static font_size(){return 20}static draw_summaries(){if(Game.canvas){var x=50;Game.canvas.draw_text("Behaviour",x,70,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text("Pts.",270,70,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text("Count",320,70,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text("Avg.",400,70,"rgba(0,0,0,1)","left",Stats.font_size());var y=100;Object.values(Stats.stats).sort((a,b)=>a.average_score()<b.average_score()?1:-1).forEach((function(stat){Game.canvas.draw_square({x:40,y:y-8,size:10,colour:stat.colour}),Game.canvas.draw_text(stat.behaviour_name,x,y,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text(stat.total_score,270,y,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text(stat.current_snakes+"/"+stat.total_snakes,320,y,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text(stat.average_score(),400,y,"rgba(0,0,0,1)","left",Stats.font_size()),y+=Stats.font_size()}))}}static draw_snakes(){if(Game.canvas){var x=50;Game.canvas.draw_text("Snake",x,70,"rgba(0,0,0,1)","left",Stats.font_size())}Game.canvas.draw_text("Spd.",x+220,70,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text("Length",x+310,70,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text("HP",x+380,70,"rgba(0,0,0,1)","left",Stats.font_size()),Game.canvas.draw_text("Points.",x+430,70,"rgba(0,0,0,1)","left",Stats.font_size());var y=100,snakes=Game.snakes;(snakes=(snakes=snakes.concat(Stats.dead_snakes)).sort((a,b)=>a.score()<b.score()?1:-1)).forEach((function(snake){var colour;colour=snake.health>0?"rgba(0,0,0,1)":"rgba(128,0,0,1)",Game.canvas.draw_square({x:x-10,y:y-8,size:10,colour:snake.colour}),Game.canvas.draw_text(snake.name,x,y,colour,"left",Stats.font_size()),Game.canvas.draw_text(snake.speed.toFixed(3),x+220,y,colour,"left",Stats.font_size()),Game.canvas.draw_text(snake.tail_segments.length,x+310,y,colour,"left",Stats.font_size()),Game.canvas.draw_text(snake.health,x+380,y,colour,"left",Stats.font_size()),Game.canvas.draw_text(snake.stats.scores[snake.name],x+430,y,colour,"left",Stats.font_size()),y+=Stats.font_size()}))}average_score(){return(void 0===this.cached_avg_tick||this.cached_avg_tick<Game.tick)&&(this.cached_avg_tick=Game.tick,this.cached_avg=this.total_score/Object.values(this.scores).length),this.cached_avg}constructor(behaviour_name){Stats.dead_snakes=[],this.behaviour_name=behaviour_name,this.total_score=0,this.total_snakes=0,this.current_snakes=0,this.scores={}}score_points(n,snake){this.total_score+=n,this.scores[snake.name]+=1}add_snake(snake){this.total_snakes+=1,this.current_snakes+=1,this.scores[snake.name]=0,this.colour=snake.colour}remove_snake(snake){Stats.dead_snakes.push(snake),this.current_snakes-=1}}class Behaviour{constructor(snake){this.snake=snake}set_target(){}new_food(){}target_removed(){}bite_tail(victim){}tail_bitten(bitten_by){}eat(){}eat_target(){}starve(){}every_tick(){}idle(){void 0===this.idle_target_tick&&(this.idle_target_tick=0),void 0===this.idle_inteval&&(this.idle_interval=400*Math.random()+100),this.tick()-this.idle_target_tick>this.idle_interval&&(this.idle_target_tick=Game.tick,this.snake.target={x:Math.random()*Game.width,y:Math.random()*Game.height})}x(){return this.snake.x}y(){return this.snake.y}food(){return Game.food}snakes(){return Game.snakes}tick(){return Game.tick}length(){return this.snakes.tail_segments.length}last_ate_tick(){return this.snake.last_ate_tick()}utils(){return Utils}game_width(){return Game.width}game_height(){return Game.height}angle(){return this.snake.get_angle()}target(object){if(void 0===object||"number"!=typeof object.x||"number"!=typeof object.y)throw console.log(this.snake.name+": Invalid target object"),console.log(object),this.snake.name+": Invalid target object";this.snake.target=object}}"undefined"==typeof Concerns&&(Concerns={}),Concerns.Catchable=class{constructor(){}remove(){Game.updatables.splice(Game.updatables.indexOf(this),1),Game.drawables.splice(Game.drawables.indexOf(this),1),Game.snakes.splice(Game.snakes.indexOf(this),1)}caught_by(){var catchable=this;return Game.snakes.find((function(snake){return Utils.touching(catchable,snake)}))}caught(){var catchable=this,result=!1;return Game.snakes.forEach((function(snake){Utils.touching(catchable,snake)&&(result=!0)})),result}},"undefined"==typeof Concerns&&(Concerns={}),Concerns.Eater=class{see_new_food(){this.behaviour.new_food()}set_target(){Game.food.length>0?this.behaviour.set_target():this.behaviour.idle()}eat(food){this.last_ate_tick=Game.tick,this.health+=1,this.speed+=.1,this.grow_tail(),this.score_point(),this.behaviour.eat(),food==this.target&&this.behaviour.eat_target()}},"undefined"==typeof Concerns&&(Concerns={}),Concerns.Follower=class{constructor(){}move(){this.get_angle(),this.x=Math.cos(this.angle*Math.PI/180)*(this.get_speed()/7)+this.x,this.y=Math.sin(this.angle*Math.PI/180)*(this.get_speed()/7)+this.y,this.history.push({x:this.x,y:this.y}),this.history.length>=25&&this.history.shift(),this.remove&&Utils.outOfRange(this)&&(console.log(Game.tick+": "+this.name+" removed because it is out of bounds"),this.remove())}get_angle(){var angle_difference=Utils.angleDifference(this.angle_to_target(),this.angle);return this.angle-=angle_difference/(200/(this.turn_speed/5)),this.angle}angle_to_target(){return Utils.angleBetweenPoints(this,this.target)}},"undefined"==typeof Concerns&&(Concerns={}),Concerns.TailBiter=class{constructor(){}bite_tail(){var me=this;Game.snakes.forEach((function(snake){snake.tail_segments&&snake.tail_segments.forEach((function(segment){Utils.touching(me,segment)&&segment.active&&(me.bite(snake),segment.get_bitten(),snake.get_bitten_by(me))}))}))}},"undefined"==typeof Static&&(Static={}),Static.Food=class extends Concerns.Catchable{constructor(){super(),this.x=Math.floor(Math.random()*Game.width),this.y=Math.floor(Math.random()*Game.height),this.size=6,this.colour="rgba(0, 256, 256, 0.8)",Game.drawables.push(this),Game.updatables.push(this),Game.food.push(this),Game.snakes.forEach((function(snake){snake.see_new_food()}))}draw(){Game.canvas.draw_square(this)}update(){this.caught()&&(this.remove(),this.caught_by().eat(this))}remove(){Game.updatables.splice(Game.updatables.indexOf(this),1),Game.drawables.splice(Game.drawables.indexOf(this),1),Game.food.splice(Game.food.indexOf(this),1),1==Game.config.famine&&(Game.config.food_interval+=Game.config.famine_step)}},"undefined"==typeof Static&&(Static={}),Static.Ghost=class{constructor(src){this.x=src.x,this.y=src.y,this.size=src.size,this.colour=Utils.change_alpha(src.colour,.1),Game.drawables.push(this)}draw(){Game.canvas.draw_circle(this)}},"undefined"==typeof Static&&(Static={}),Static.Text=class{constructor(text,x,y,size,align){this.text=text,this.size=size,this.x=x,this.y=y,this.align=align}draw(){Game.canvas.draw_text(this.text,this.x,this.y,"rgba(0,0,0,0.3)",this.align,this.size)}},"undefined"==typeof Creatures&&(Creatures={}),Creatures.Snake=class extends(mix(Concerns.Follower,Concerns.TailBiter,Concerns.Eater)){constructor(behaviour){super(),this.behaviour=new behaviour(this),Utils.cookies().snake==behaviour.name?this.colour=Utils.change_alpha(this.behaviour.colour(),.6):this.colour=this.behaviour.colour(),this.name=Game.register_snake(this.behaviour.name()),this.stats=Stats.for_behaviour(this.behaviour.name()),this.stats.add_snake(this),this.x=Math.random()*Game.width,this.y=Math.random()*Game.height,this.target={x:0,y:0},this.angle=this.angle_to_target(),this.turn_speed=40,this.size=40,this.speed=20,this.angle=0,this.tail_segments=[],this.health=20,this.last_ate_tick=Game.tick,this.behaviour.set_target(),this.history=this.init_history(),this.grow_tail(),this.grow_tail(),Game.updatables.push(this),Game.drawables.push(this),Game.snakes.push(this)}score_point(){this.stats.score_points(1,this)}init_history(){return[{x:60*Math.sin(this.angle*Math.PI/180)+this.x,y:60*Math.cos(this.angle*Math.PI/180)+this.y}]}update(){for(var segment in this.move(),this.bite_tail(),this.tail_segments)this.tail_segments[segment].move();0==Game.food.length?this.behaviour.idle():Game.food.includes(this.target)||Game.snakes.includes(this.target)||this.behaviour.target_removed(),this.check_for_starvation(),Game.tick>0&&Game.tick%1e3==0&&this.score_point()}draw(){Game.canvas.draw_circle(this),this.tail_segments.forEach((function(segment){segment.draw()}))}get_speed(){return this.speed}score(){return this.stats.scores[this.name]}get_bitten_by(biter){this.speed=20,this.health<=0&&(console.log(Game.tick+": "+this.name+" died because it's tail was bitten by "+biter.name),this.remove(),biter.score_point())}bite(snake){this.last_ate_tick=Game.tick,this.speed+=snake.speed/10,this.behaviour.bite_tail(snake),snake.behaviour.tail_bitten(this),snake!=this&&this.score_point()}remove(){Game.updatables.splice(Game.updatables.indexOf(this),1),Game.drawables.splice(Game.drawables.indexOf(this),1),Game.snakes.splice(Game.snakes.indexOf(this),1),new Static.Ghost(this),this.tail_segments.forEach((function(segment){new Static.Ghost(segment)})),this.stats.remove_snake(this)}grow_tail(){var target=this.tail_segments[this.tail_segments.length-1];null==target&&(target=this),this.tail_segments.push(new Creatures.TailSegment(target,this))}check_for_starvation(){Game.tick-this.last_ate_tick>Game.config.starvation_interval&&(0==this.tail_segments.length?(console.log(Game.tick+": "+this.name+" died of starvation"),this.remove()):(this.last_ate_tick=Game.tick,this.tail_segments.pop(),this.behaviour.starve()))}},"undefined"==typeof Creatures&&(Creatures={}),Creatures.TailSegment=class extends(mix(Concerns.Follower)){constructor(previous,head){super(),this.head=head,previous.history[0]?(this.x=previous.history[0].x,this.y=previous.history[0].y):(this.x=previous.x,this.y=previous.y),this.size=30,this.speed=previous.speed,this.colour=head.colour,this.turn_speed=100,this.angle=previous.angle,this.target=previous,this.history=[],this.active=head.tail_segments.length>1}draw(){Game.canvas.draw_circle(this)}get_speed(){return this.head.speed}get_bitten(){this.head.health-=2*(this.head.tail_segments.length-this.head.tail_segments.indexOf(this)),this.head.tail_segments.splice(this.head.tail_segments.indexOf(this),this.head.tail_segments.length-1)}},"undefined"==typeof Behaviours&&(Behaviours={}),Behaviours.Farthest=class extends Behaviour{constructor(snake){super(snake)}name(){return"Farthest Food"}colour(){return"rgba(0,255,0,0.4)"}set_target(){var behaviour=this;if(0==this.food().length)this.idle();else{var distances=this.food().map((function(food){return behaviour.utils().distanceBetweenPoints(behaviour.snake,food)})),max_distance=Math.max(...distances);this.target(this.food()[distances.indexOf(max_distance)])}}target_removed(){this.set_target()}eat_target(){this.set_target()}},"undefined"==typeof Behaviours&&(Behaviours={}),Behaviours.HighRotation=class extends Behaviour{constructor(snake){super(snake)}name(){return"High Rotation"}colour(){return"rgba(128,0,128,0.4)"}set_target(){var behaviour=this;if(0==this.food().length)this.idle();else{var angles=this.food().map((function(food){var angle=behaviour.utils().angleBetweenPoints(food,behaviour.snake);return Math.abs(behaviour.utils().angleDifference(angle,behaviour.angle()))})),max_angle=Math.min(...angles);this.target(behaviour.food()[angles.indexOf(max_angle)])}}target_removed(){this.set_target()}eat(){this.set_target()}},Behaviours.Imported=class extends Behaviour{constructor(snake){super(snake),this.spot={x:Math.random()*this.game_width(),y:Math.random()*this.game_height()}}name(){return"Imported"}colour(){return"rgba(0,255,255,0.4)"}set_target(){this.target(this.spot)}idle(){this.target(this.spot)}},"undefined"==typeof Behaviours&&(Behaviours={}),Behaviours.LowRotation=class extends Behaviour{constructor(snake){super(snake)}name(){return"Low Rotation"}colour(){return"rgba(128,128,128,0.4)"}set_target(){var behaviour=this;if(0==this.food().length)this.idle();else{var angles=this.food().map((function(food){var angle=behaviour.utils().angleBetweenPoints(food,behaviour.snake);return Math.abs(behaviour.utils().angleDifference(angle,behaviour.angle()))})),min_angle=Math.max(...angles);this.target(behaviour.food()[angles.indexOf(min_angle)])}}target_removed(){this.set_target()}eat(){this.set_target()}new_food(){this.set_target()}},"undefined"==typeof Behaviours&&(Behaviours={}),Behaviours.Nearest=class extends Behaviour{constructor(snake){super(snake)}name(){return"Nearest Food"}colour(){return"rgba(255,0,0,0.4)"}set_target(){var behaviour=this;if(0==this.food().length)this.idle();else{var distances=this.food().map((function(food){return behaviour.utils().distanceBetweenPoints(behaviour.snake,food)})),min_distance=Math.min(...distances);this.target(this.food()[distances.indexOf(min_distance)])}}target_removed(){this.set_target()}eat(){this.set_target()}new_food(){this.set_target()}},"undefined"==typeof Behaviours&&(Behaviours={}),Behaviours.Parasite=class extends Behaviour{constructor(snake){super(snake)}name(){return"Parasite"}colour(){return"rgba(0,0,0,0.4)"}set_target(){if(0==this.snakes().length)this.idle();else{var parasite=this.snake,distances=this.snakes().map((function(snake){if(snake==parasite)return 99999;var length=snake.tail_segments.length;return Utils.distanceBetweenPoints(parasite,snake)-1e3*length})),min_distance=Math.min(...distances),target=this.snakes()[distances.indexOf(min_distance)];target==this.snake?this.target={x:this.game_width()/2,y:this.game_height()/2}:this.target(target)}}every_tick(){this.set_target()}},"undefined"==typeof Behaviours&&(Behaviours={}),Behaviours.Random=class extends Behaviour{constructor(snake){super(snake)}name(){return"Random Food"}colour(){return"rgba(0,0,255,0.4)"}set_target(){0==this.food().length?this.idle():this.target(this.food()[Math.floor(Math.random()*this.food().length)])}target_removed(){this.set_target()}eat(){this.set_target()}},"undefined"==typeof Behaviours&&(Behaviours={}),Behaviours.TopHugger=class extends Behaviour{constructor(snake){super(snake)}name(){return"Top Hugger"}colour(){return"rgba(255,128,0,0.4)"}set_target(){if(0==this.food().length)this.idle();else{var heights=this.food().map((function(food){return food.y})),min_height=Math.min(...heights);this.target(this.food()[heights.indexOf(min_height)])}}target_removed(){this.set_target()}eat(){this.set_target()}new_food(){this.set_target()}},Config={index:0,opponent_index:0,all_behaviours:function(){return Object.values(Behaviours)},single_behaviour:function(index){return[Object.values(Behaviours)[index]]},current_behaviour:function(){return Config.single_behaviour(Config.index)},current_opponent:function(){return Config.single_behaviour(Config.opponent_index)},current_pair:function(){return Config.current_behaviour().concat(Config.current_opponent())},next_behaviour:function(){var current=Config.current_behaviour();return Config.index++,current},next_opponent:function(){var current=Config.current_opponent();return Config.opponent_index++,current},finished:function(){return Config.index>=Object.keys(Behaviours).length},reset_indexes:function(){Config.index=0,Config.opponent_index=0},build_config:function(config){var new_config={};return Object.keys(config).forEach((function(key){"function"==typeof config[key]?new_config[key]=config[key]():new_config[key]=config[key]})),new_config},build_config_for_all:function(config){for(Config.reset_indexes(),configs=[];!Config.finished();)configs.push(Config.build_config(config)),Config.next_behaviour();return configs},build_config_for_all_pairs:function(config){for(Config.reset_indexes(),configs=[];!Config.finished();){for(Config.opponent_index=0;Config.opponent_index<Object.keys(Behaviours).length;)configs.push(Config.build_config(config)),Config.next_opponent();Config.next_behaviour()}return configs},from_url:function(){if("undefined"!=typeof window){var url=window.location.href,attrs={};if(url.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(m,key,value){attrs[key]=value})),attrs.snake&&(Config.index=Object.keys(Behaviours).indexOf(attrs.snake),-1==Config.index))throw"Unknown snake: "+attrs.snake;if(attrs.opponent&&(Config.opponent_index=Object.keys(Behaviours).indexOf(attrs.opponent),-1==Config.index))throw"Unknown snake: "+attrs.snake;var config=Configs[attrs.config];if(void 0===config)throw"Unknown config: "+attrs.config;return Config.build_config(config)}}},"undefined"==typeof Configs&&(Configs={}),Configs.all_famine={id:"all_famine",type:"all",name:"Famine Mode - All snakes",title:"Famine Mode - All snakes",min_snakes:0,starting_food_mode:"rng",starting_food:20,grid_size:100,food_interval:50,famine:!0,famine_step:5,starting_behaviours:Config.all_behaviours,snakes_of_each_behaviour:1,respawn_behaviours:Config.all_behaviours,min_starting_snakes:0,starvation_interval:500},"undefined"==typeof Configs&&(Configs={}),Configs.big={id:"big",type:"all",name:"Big Swarm Mode - All snakes",title:"Big Swarm Mode - All snakes",min_snakes:0,starting_food_mode:"rng",starting_food:200,grid_size:100,food_interval:5,famine:!1,starting_behaviours:Config.all_behaviours,snakes_of_each_behaviour:10,respawn_behaviours:Config.all_behaviours,min_starting_snakes:0,starvation_interval:500},"undefined"==typeof Configs&&(Configs={}),Configs.grid={id:"grid",type:"solo",name:function(){return"Solo on grid: "+(new(Config.current_behaviour()[0])).name()},title:"Solo on Grid",min_snakes:0,starting_food_mode:"grid",starting_food:20,grid_size:100,food_interval:5e7,famine:!1,starting_behaviours:Config.current_behaviour,snakes_of_each_behaviour:1,respawn_behaviours:Config.current_behaviour,min_starting_snakes:0,starvation_interval:500},"undefined"==typeof Configs&&(Configs={}),Configs.one_vs_five={id:"one_vs_five",type:"versus",name:function(){var dummy_behaviour=new(Config.current_behaviour()[0]),dummy_opponent=new(Config.current_opponent()[0]);return"1 "+dummy_behaviour.name()+" Vs. 5 x "+dummy_opponent.name()},title:"One Vs. Five",min_snakes:0,starting_food_mode:"rng",starting_food:20,grid_size:100,food_interval:50,famine:!1,starting_behaviours:function(){var pair=Config.current_pair();return[pair[0],pair[1],pair[1],pair[1],pair[1],pair[1]]},snakes_of_each_behaviour:1,respawn_behaviours:Config.current_pair,min_starting_snakes:0,starvation_interval:500},"undefined"==typeof Configs&&(Configs={}),Configs.royale={id:"royale",type:"all",name:"Battle Royale - All snakes",title:"Battle Royale - All snakes",min_snakes:0,starting_food_mode:"rng",starting_food:20,grid_size:100,food_interval:50,famine:!1,starting_behaviours:Config.all_behaviours,snakes_of_each_behaviour:1,respawn_behaviours:Config.all_behaviours,min_starting_snakes:0,starvation_interval:500},"undefined"==typeof Configs&&(Configs={}),Configs.solo_famine={id:"solo_famine",type:"solo",name:function(){return"Famine Mode: "+(new(Config.current_behaviour()[0])).name()},title:"Famine Mode",min_snakes:0,starting_food_mode:"rng",starting_food:10,grid_size:100,food_interval:50,famine:!0,famine_step:30,starting_behaviours:Config.current_behaviour,snakes_of_each_behaviour:1,respawn_behaviours:Config.all_behaviours,min_starting_snakes:0,starvation_interval:500},"undefined"==typeof Configs&&(Configs={}),Configs.swarm={id:"swarm",type:"solo",name:function(){return"Swarm Mode: 20 x "+(new(Config.current_behaviour()[0])).name()},title:"Swarm Mode",min_snakes:0,starting_food_mode:"rng",starting_food:200,grid_size:100,food_interval:5,famine:!1,starting_behaviours:Config.current_behaviour,snakes_of_each_behaviour:20,respawn_behaviours:Config.current_behaviour,min_starting_snakes:0,starvation_interval:500},"undefined"==typeof Configs&&(Configs={}),Configs.duel={id:"duel",type:"versus",name:function(){var dummy_behaviour=new(Config.current_behaviour()[0]),dummy_opponent=new(Config.current_opponent()[0]);return"Duel: "+dummy_behaviour.name()+"  Vs. "+dummy_opponent.name()},title:"Duel",min_snakes:0,starting_food_mode:"rng",starting_food:20,grid_size:100,food_interval:50,famine:!1,starting_behaviours:Config.current_pair,snakes_of_each_behaviour:1,respawn_behaviours:Config.current_pair,min_starting_snakes:0,starvation_interval:500},"undefined"==typeof Configs&&(Configs={}),Configs.watch={id:"royale",type:"all",name:"",title:"Watch",min_snakes:3,starting_food_mode:"rng",starting_food:30,grid_size:100,food_interval:50,famine:!1,starting_behaviours:Config.all_behaviours,snakes_of_each_behaviour:1,respawn_behaviours:Config.all_behaviours,min_starting_snakes:20,starvation_interval:500};module.exports = {Game: Game, Config: Config, Configs: Configs, Stats: Stats};
